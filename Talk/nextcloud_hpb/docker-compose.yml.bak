version: '3.7'

services:
  nextcloud-aio-talk:
    image: nextcloud/aio-talk:latest
    init: true
    ports:
      - 3478:3478/tcp
      - 3478:3478/udp
    expose:
      - "8081"
    environment:
      - NC_DOMAIN=next1.utmino.site
      - TURN_SECRET=eMwDFBHK6mMjWi9mB7gYUbbxEeNFrslv
      - SIGNALING_SECRET=eMwDFBHK6mMjWi9mB7gYUbbxEeNFrslv
      - TZ=Asia/Tbilisi
      - TALK_PORT=3478
      - INTERNAL_SECRET=qHGL7OOOiGTsIkuDomK6uWbbwekOldA4
    restart: unless-stopped
    profiles:
      - talk
      - talk-recording
    networks:
      - nextcloud-aio
    read_only: true
    tmpfs:
      - /var/log/supervisord
      - /var/run/supervisord
      - /opt/eturnal/run
      - /conf
      - /tmp

  nextcloud-aio-talk-recording:
    image: nextcloud/aio-talk-recording:latest
    init: true
    expose:
      - "1234"
    environment:
      - NC_DOMAIN=next1.utmino.site
      - TZ=Asia/tbilisi
      - RECORDING_SECRET=O1TKbhkMZ6VJ2zTPNQQspiWwB3g8wTud
      - INTERNAL_SECRET=qHGL7OOOiGTsIkuDomK6uWbbwekOldA4
    shm_size: 2147483648
    restart: unless-stopped
    profiles:
      - talk-recording
    networks:
      - nextcloud-aio
    read_only: true
    tmpfs:
      - /tmp
      - /conf

networks:
  nextcloud-aio:
    name: nextcloud-aio
    driver: bridge
